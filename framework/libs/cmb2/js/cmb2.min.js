window.CMB2=(function(c,a,e,h){var b=c.cmb2_l10;var d=c.setTimeout;var g={idNumber:false,repeatEls:'input:not([type="button"],[id^=filelist]),select,textarea,.cmb2-media-status',noEmpty:'input:not([type="button"]):not([type="radio"]):not([type="checkbox"]),textarea',repeatUpdate:'input:not([type="button"]),select,textarea,label',styleBreakPoint:450,mediaHandlers:{},neweditor_id:[],defaults:{time_picker:b.defaults.time_picker,date_picker:b.defaults.date_picker,color_picker:b.defaults.color_picker||{}},media:{frames:{}}};var f=function(i){return e(a.getElementById(i))};g.metabox=function(){if(g.$metabox){return g.$metabox}g.$metabox=e(".cmb2-wrap > .cmb2-metabox");return g.$metabox};g.init=function(){g.log("CMB2 localized data",b);var i=g.metabox();var j=i.find(".cmb-repeatable-group");g.initPickers(i.find('input[type="text"].cmb2-timepicker'),i.find('input[type="text"].cmb2-datepicker'),i.find('input[type="text"].cmb2-colorpicker'));f("ui-datepicker-div").wrap('<div class="cmb2-element" />');e('<p><span class="button cmb-multicheck-toggle">'+b.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)");g.makeListSortable();i.on("change",".cmb2_upload_file",function(){g.media.field=e(this).attr("id");f(g.media.field+"_id").val("")}).on("click",".cmb-multicheck-toggle",g.toggleCheckBoxes).on("click",".cmb2-upload-button",g.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",g.handleFileClick).on("click",".cmb2-remove-file-button",g.handleRemoveMedia).on("click",".cmb-add-group-row",g.addGroupRow).on("click",".cmb-add-row-button",g.addAjaxRow).on("click",".cmb-remove-group-row",g.removeGroupRow).on("click",".cmb-remove-row-button",g.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",g.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",g.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",g.toggleHandle);if(j.length){j.filter(".sortable").each(function(){e(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+b.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+b.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",g.shiftRows).on("cmb2_add_row",g.emptyValue)}d(g.resizeoEmbeds,500);e(c).on("resize",g.resizeoEmbeds)};g.resetTitlesAndIterator=function(){e(".cmb-repeatable-group").each(function(){var i=e(this);i.find(".cmb-repeatable-grouping").each(function(k){var j=e(this);j.data("iterator",k);j.find(".cmb-group-title h4").text(i.find(".cmb-add-group-row").data("grouptitle").replace("{#}",(k+1)))})})};g.toggleHandle=function(i){i.preventDefault();e(a).trigger("postbox-toggled",e(this).parent(".postbox").toggleClass("closed"))};g.toggleCheckBoxes=function(i){i.preventDefault();var k=e(this);var j=k.closest(".cmb-td").find("input[type=checkbox]:not([disabled])");if(k.data("checked")){j.prop("checked",false);k.data("checked",false)}else{j.prop("checked",true);k.data("checked",true)}};g.handleMedia=function(i){i.preventDefault();var j=e(this);g.attach_id=!j.hasClass("cmb2-upload-list")?j.closest(".cmb-td").find(".cmb2-upload-file-id").val():false;g.attach_id="0"!==g.attach_id?g.attach_id:false;g._handleMedia(j.prev("input.cmb2-upload-file").attr("id"),j.hasClass("cmb2-upload-list"))};g.handleFileClick=function(i){i.preventDefault();var j=e(this);var l=j.closest(".cmb-td");var k=l.find(".cmb2-upload-button").hasClass("cmb2-upload-list");g.attach_id=k?j.find('input[type="hidden"]').data("id"):l.find(".cmb2-upload-file-id").val();if(g.attach_id){g._handleMedia(l.find("input.cmb2-upload-file").attr("id"),k,g.attach_id)}};g._handleMedia=function(i,l){if(!wp){return}var k=g.media;k.field=i;k.$field=f(k.field);k.fieldData=k.$field.data();k.previewSize=k.fieldData.previewsize;k.fieldName=k.$field.attr("name");var j,m;if(k.field in k.frames){k.frames[k.field].open();return}k.frames[k.field]=wp.media({title:g.metabox().find("label[for="+k.field+"]").text(),library:k.fieldData.queryargs||{},button:{text:b.strings[l?"upload_files":"upload_file"]},multiple:l?"add":false});g.mediaHandlers.list=function(p,n){m=p.toJSON();k.$field.val(m.url);f(k.field+"_id").val(m.id);var o=[];e(m).each(function(){if(this.type&&this.type==="image"){var r=k.previewSize[0]?k.previewSize[0]:50;var q=k.previewSize[1]?k.previewSize[1]:50;j='<li class="img-status"><img width="'+r+'" height="'+q+'" src="'+this.url+'" class="attachment-'+r+"px"+q+'px" alt="'+this.filename+'"><p><a href="#" class="cmb2-remove-file-button" rel="'+k.field+"["+this.id+']">'+b.strings.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+k.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}else{j='<li class="file-status"><span>'+b.strings.file+" <strong>"+this.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+b.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+k.field+"["+this.id+']">'+b.strings.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+k.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}o.push(j)});if(!n){e(o).each(function(){k.$field.siblings(".cmb2-media-status").slideDown().append(this)})}else{return o}};g.mediaHandlers.single=function(o){m=o.first().toJSON();k.$field.val(m.url);f(k.field+"_id").val(m.id);if(m.type&&m.type==="image"){var n=k.previewSize[0]?k.previewSize[0]:350;j='<div class="img-status"><img width="'+n+'px" style="max-width: '+n+'px; width: 100%; height: auto;" src="'+m.url+'" alt="'+m.filename+'" title="'+m.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+k.field+'">'+b.strings.remove_image+"</a></p></div>"}else{j='<div class="file-status"><span>'+b.strings.file+" <strong>"+m.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+m.url+'" target="_blank" rel="external">'+b.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+k.field+'">'+b.strings.remove_file+"</a>)</div>"}k.$field.siblings(".cmb2-media-status").slideDown().html(j)};g.mediaHandlers.selectFile=function(){var o=k.frames[k.field].state().get("selection");var n=l?"list":"single";if(g.attach_id&&l){e('[data-id="'+g.attach_id+'"]').parents("li").replaceWith(g.mediaHandlers.list(o,true));return}g.mediaHandlers[n](o)};g.mediaHandlers.openModal=function(){var o=k.frames[k.field].state().get("selection");if(!g.attach_id){return o.reset()}var n=wp.media.attachment(g.attach_id);n.fetch();o.set(n?[n]:[])};k.frames[k.field].on("select",g.mediaHandlers.selectFile).on("open",g.mediaHandlers.openModal);k.frames[k.field].open()};g.handleRemoveMedia=function(i){i.preventDefault();var j=e(this);if(j.is(".cmb-attach-list .cmb2-remove-file-button")){j.parents("li").remove();return false}g.media.field=j.attr("rel");g.metabox().find("input#"+g.media.field).val("");g.metabox().find("input#"+g.media.field+"_id").val("");j.parents(".cmb2-media-status").html("");return false};g.cleanRow=function(i,k,m){var j=i.find(g.repeatUpdate);if(m){var l=i.find("[id]").not(g.repeatUpdate);i.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove();if(l.length){l.each(function(){var p=e(this);var q=p.attr("id");var n=q.replace("_"+k,"_"+g.idNumber);var o=i.find('[data-selector="'+q+'"]');p.attr("id",n);if(o.length){o.attr("data-selector",n).data("selector",n)}})}}g.neweditor_id=[];j.filter(":checked").prop("checked",false);j.filter(":selected").prop("selected",false);if(i.find("h3.cmb-group-title").length){i.find("h3.cmb-group-title").text(i.data("title").replace("{#}",(g.idNumber+1)))}j.each(function(){var x=e(this);var p=x.hasClass("wp-editor-area");var q=x.attr("for");var y=x.attr("value");var w=x.prop("type");var o="radio"===w||"checkbox"===w?y:false;var z={};var u,t;if(q){z={"for":q.replace("_"+k,"_"+g.idNumber)}}else{var n=x.attr("name");var v=n?n.replace("["+k+"]","["+g.idNumber+"]"):"";t=x.attr("id");u=t?t.replace("_"+k,"_"+g.idNumber):"";z={id:u,name:v,"data-iterator":g.idNumber}}if(h!==typeof(y)&&y||o){z.value=o?o:""}if("TEXTAREA"===x.prop("tagName")){x.html("")}if(o){x.removeAttr("checked")}x.removeClass("hasDatepicker").attr(z).val(o?o:"");if(p){u=u?t.replace("zx"+k,"zx"+g.idNumber):"";x.html("");var r=x.parents(".cmb-type-wysiwyg");r.find(".mce-tinymce:not(:first-child)").remove();var s=r.html().replace(new RegExp(t,"g"),u);r.html(s);g.neweditor_id.push({id:u,old:t})}});return g};g.newRowHousekeeping=function(i){var k=i.find(".wp-picker-container");var j=i.find(".cmb2-media-status");if(k.length){k.each(function(){var l=e(this).parent();l.html(l.find('input[type="text"].cmb2-colorpicker').attr("style",""))})}if(j.length){j.empty()}return g};g.afterRowInsert=function(l){var o;if(g.neweditor_id.length){var n;for(n=g.neweditor_id.length-1;n>=0;n--){var p=g.neweditor_id[n].id;var m=g.neweditor_id[n].old;if(typeof(tinyMCEPreInit.mceInit[p])==="undefined"){var k=jQuery.extend({},tinyMCEPreInit.mceInit[m]);for(o in k){if("string"===typeof(k[o])){k[o]=k[o].replace(new RegExp(m,"g"),p)}}tinyMCEPreInit.mceInit[p]=k}if(typeof(tinyMCEPreInit.qtInit[p])==="undefined"){var j=jQuery.extend({},tinyMCEPreInit.qtInit[m]);for(o in j){if("string"===typeof(j[o])){j[o]=j[o].replace(new RegExp(m,"g"),p)}}tinyMCEPreInit.qtInit[p]=j}tinyMCE.init({id:tinyMCEPreInit.mceInit[p]})}}g.initPickers(l.find('input[type="text"].cmb2-timepicker'),l.find('input[type="text"].cmb2-datepicker'),l.find('input[type="text"].cmb2-colorpicker'))};g.updateNameAttr=function(){var m=e(this);var j=m.attr("name");if(typeof j!=="undefined"){var k=parseInt(m.parents(".cmb-repeatable-grouping").data("iterator"));var l=k-1;var i=j.replace("["+k+"]","["+l+"]");m.attr("name",i)}};g.emptyValue=function(i,j){e(g.noEmpty,j).val("")};g.addGroupRow=function(j){j.preventDefault();var o=e(this);o.trigger("cmb2_add_group_row_start",o);var k=f(o.data("selector"));var m=k.find(".cmb-repeatable-grouping").last();var l=parseInt(m.data("iterator"));g.idNumber=l+1;var i=m.clone();g.newRowHousekeeping(i.data("title",o.data("grouptitle"))).cleanRow(i,l,true);i.find(".cmb-add-row-button").prop("disabled",false);var n=e('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+g.idNumber+'">'+i.html()+"</div>");m.after(n);g.afterRowInsert(n);if(k.find(".cmb-repeatable-grouping").length<=1){k.find(".cmb-remove-group-row").prop("disabled",true)}else{k.find(".cmb-remove-group-row").prop("disabled",false)}k.trigger("cmb2_add_row",n)};g.addAjaxRow=function(j){j.preventDefault();var n=e(this);var k=f(n.data("selector"));var m=k.find(".empty-row");var l=parseInt(m.find("[data-iterator]").data("iterator"));g.idNumber=l+1;var i=m.clone();g.newRowHousekeeping(i).cleanRow(i,l);m.removeClass("empty-row hidden").addClass("cmb-repeat-row");m.after(i);g.afterRowInsert(i);k.trigger("cmb2_add_row",i);k.find(".cmb-remove-row-button").removeClass("button-disabled")};g.removeGroupRow=function(i){i.preventDefault();var m=e(this);var j=f(m.data("selector"));var l=m.parents(".cmb-repeatable-grouping");var k=j.find(".cmb-repeatable-grouping").length;if(k>1){j.trigger("cmb2_remove_group_row_start",m);l.nextAll(".cmb-repeatable-grouping").find(g.repeatEls).each(g.updateNameAttr);l.remove();if(k<=2){j.find(".cmb-remove-group-row").prop("disabled",true)}else{j.find(".cmb-remove-group-row").prop("disabled",false)}j.trigger("cmb2_remove_row")}};g.removeAjaxRow=function(i){i.preventDefault();var m=e(this);if(m.hasClass("button-disabled")){return}var l=m.parents(".cmb-row");var j=m.parents(".cmb-repeat-table");var k=j.find(".cmb-row").length;if(k>2){if(l.hasClass("empty-row")){l.prev().addClass("empty-row").removeClass("cmb-repeat-row")}m.parents(".cmb-repeat-table .cmb-row").remove();if(k===3){j.find(".cmb-remove-row-button").addClass("button-disabled")}j.trigger("cmb2_remove_row")}else{m.addClass("button-disabled")}};g.shiftRows=function(j){j.preventDefault();var m=e(this);m.trigger("cmb2_shift_rows_enter",m);var l=m.parents(".cmb-repeatable-grouping");var i=m.hasClass("move-up")?l.prev(".cmb-repeatable-grouping"):l.next(".cmb-repeatable-grouping");if(!i.length){return}m.trigger("cmb2_shift_rows_start",m);var k=[];l.find(g.repeatEls).each(function(){var o=e(this);var n=o.attr("type");var p;if(o.hasClass("cmb2-media-status")){p=o.html()}else{if("checkbox"===n||"radio"===n){p=o.is(":checked")}else{if("select"===o.prop("tagName")){p=o.is(":selected")}else{p=o.val()}}}k.push({val:p,$:o})});i.find(g.repeatEls).each(function(q){var o=e(this);var n=o.attr("type");var r;if(o.hasClass("cmb2-media-status")){var p=o.closest(".cmb-repeatable-grouping").attr("data-iterator");var s=k[q]["$"].closest(".cmb-repeatable-grouping").attr("data-iterator");r=o.html();o.html(k[q].val);k[q].$.html(r);k[q].$.find("input").each(function(){var t=e(this).attr("name");t=t.replace("["+p+"]","["+s+"]");e(this).attr("name",t)});o.find("input").each(function(){var t=e(this).attr("name");t=t.replace("["+s+"]","["+p+"]");e(this).attr("name",t)})}else{if("checkbox"===n){k[q].$.prop("checked",o.is(":checked"));o.prop("checked",k[q].val)}else{if("radio"===n){if(o.is(":checked")){k[q].$.attr("data-checked","true")}if(k[q].$.is(":checked")){o.attr("data-checked","true")}}else{if("select"===o.prop("tagName")){k[q].$.prop("selected",o.is(":selected"));o.prop("selected",k[q].val)}else{k[q].$.val(o.val());o.val(k[q].val)}}}}});l.find("input[data-checked=true]").prop("checked",true).removeAttr("data-checked");i.find("input[data-checked=true]").prop("checked",true).removeAttr("data-checked");m.trigger("cmb2_shift_rows_complete",m)};g.initPickers=function(j,k,i){g.initTimePickers(j);g.initDatePickers(k);g.initColorPickers(i)};g.initTimePickers=function(i){if(!i.length){return}i.timepicker("destroy");i.timepicker(g.defaults.time_picker)};g.initDatePickers=function(i){if(!i.length){return}i.datepicker("destroy");i.datepicker(g.defaults.date_picker)};g.initColorPickers=function(i){if(!i.length){return}if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){i.wpColorPicker(g.defaults.color_picker)}else{i.each(function(j){e(this).after('<div id="picker-'+j+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');f("picker-"+j).hide().farbtastic(e(this))}).focus(function(){e(this).next().show()}).blur(function(){e(this).next().hide()})}};g.makeListSortable=function(){var i=g.metabox().find(".cmb2-media-status.cmb-attach-list");if(i.length){i.sortable({cursor:"move"}).disableSelection()}};g.maybeOembed=function(j){var l=e(this);var k=j.type;var i={focusout:function(){d(function(){g.spinner(".postbox .cmb2-metabox",true)},2000)},keyup:function(){var m=function(o,n){return(j.which<=n&&j.which>=o)};if(m(48,90)||m(96,111)||m(8,9)||j.which===187||j.which===190){g.doAjax(l,j)}},paste:function(){d(function(){g.doAjax(l)},100)}};i[k]()};g.resizeoEmbeds=function(){g.metabox().each(function(){var q=e(this);var n=q.parents(".inside");var j=q.parents(".inner-sidebar").length||q.parents("#side-sortables").length;var l=j;var k=false;if(!n.length){return true}var i=n.width();if(g.styleBreakPoint>i){l=true;k=(g.styleBreakPoint-62)>i}i=l?i:Math.round((n.width()*0.82)*0.97);var m=i-30;if(l&&!j&&!k){m=m-75}if(m>639){return true}var o=q.find(".cmb-type-oembed .embed-status");var p=o.children().not(".cmb2-remove-wrapper");if(!p.length){return true}p.each(function(){var u=e(this);var s=u.width();var v=u.height();var t=m;if(u.parents(".cmb-repeat-row").length&&!l){t=m-91;t=785>i?t-15:t}var r=Math.round((t*v)/s);u.width(t).height(r)})})};g.log=function(){if(b.script_debug&&console&&typeof console.log==="function"){console.log.apply(console,arguments)}};g.spinner=function(i,j){if(j){e(".cmb-spinner",i).hide()}else{e(".cmb-spinner",i).show()}};g.doAjax=function(p){var l=p.val();if(l.length<6){return}var m=p.attr("id");var i=p.closest(".cmb-td");var o=i.find(".embed-status");var n=i.find(".embed_wrap");var j=o.find(":first-child");var k=o.length&&j.length?j.width():p.width();g.log("oembed_url",l,m);g.spinner(i);n.html("");d(function(){if(e(".cmb2-oembed:focus").val()!==l){return}e.ajax({type:"post",dataType:"json",url:b.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:l,oembed_width:k>300?k:300,field_id:m,object_id:p.data("objectid"),object_type:p.data("objecttype"),cmb2_ajax_nonce:b.ajax_nonce},success:function(q){g.log(q);g.spinner(i,true);n.html(q.data)}})},500)};e(a).ready(g.init);return g})(window,document,jQuery);