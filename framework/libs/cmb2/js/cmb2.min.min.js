window.CMB2=(function(p,j,n,k){var i=p.cmb2_l10;var o=p.setTimeout;var l={idNumber:false,repeatEls:'input:not([type="button"],[id^=filelist]),select,textarea,.cmb2-media-status',noEmpty:'input:not([type="button"]):not([type="radio"]):not([type="checkbox"]),textarea',repeatUpdate:'input:not([type="button"]),select,textarea,label',styleBreakPoint:450,mediaHandlers:{},neweditor_id:[],defaults:{time_picker:i.defaults.time_picker,date_picker:i.defaults.date_picker,color_picker:i.defaults.color_picker||{}},media:{frames:{}}};var m=function(a){return n(j.getElementById(a))};l.metabox=function(){if(l.$metabox){return l.$metabox}l.$metabox=n(".cmb2-wrap > .cmb2-metabox");return l.$metabox};l.init=function(){l.log("CMB2 localized data",i);var b=l.metabox();var a=b.find(".cmb-repeatable-group");l.initPickers(b.find('input[type="text"].cmb2-timepicker'),b.find('input[type="text"].cmb2-datepicker'),b.find('input[type="text"].cmb2-colorpicker'));m("ui-datepicker-div").wrap('<div class="cmb2-element" />');n('<p><span class="button cmb-multicheck-toggle">'+i.strings.check_toggle+"</span></p>").insertBefore(".cmb2-checkbox-list:not(.no-select-all)");l.makeListSortable();b.on("change",".cmb2_upload_file",function(){l.media.field=n(this).attr("id");m(l.media.field+"_id").val("")}).on("click",".cmb-multicheck-toggle",l.toggleCheckBoxes).on("click",".cmb2-upload-button",l.handleMedia).on("click",".cmb-attach-list li, .cmb2-media-status .img-status img, .cmb2-media-status .file-status > span",l.handleFileClick).on("click",".cmb2-remove-file-button",l.handleRemoveMedia).on("click",".cmb-add-group-row",l.addGroupRow).on("click",".cmb-add-row-button",l.addAjaxRow).on("click",".cmb-remove-group-row",l.removeGroupRow).on("click",".cmb-remove-row-button",l.removeAjaxRow).on("keyup paste focusout",".cmb2-oembed",l.maybeOembed).on("cmb2_remove_row",".cmb-repeatable-group",l.resetTitlesAndIterator).on("click",".cmbhandle, .cmbhandle + .cmbhandle-title",l.toggleHandle);if(a.length){a.filter(".sortable").each(function(){n(this).find(".button.cmb-remove-group-row").before('<a class="button cmb-shift-rows move-up alignleft" href="#"><span class="'+i.up_arrow_class+'"></span></a> <a class="button cmb-shift-rows move-down alignleft" href="#"><span class="'+i.down_arrow_class+'"></span></a>')}).on("click",".cmb-shift-rows",l.shiftRows).on("cmb2_add_row",l.emptyValue)}o(l.resizeoEmbeds,500);n(p).on("resize",l.resizeoEmbeds)};l.resetTitlesAndIterator=function(){n(".cmb-repeatable-group").each(function(){var a=n(this);a.find(".cmb-repeatable-grouping").each(function(b){var c=n(this);c.data("iterator",b);c.find(".cmb-group-title h4").text(a.find(".cmb-add-group-row").data("grouptitle").replace("{#}",(b+1)))})})};l.toggleHandle=function(a){a.preventDefault();n(j).trigger("postbox-toggled",n(this).parent(".postbox").toggleClass("closed"))};l.toggleCheckBoxes=function(c){c.preventDefault();var a=n(this);var b=a.closest(".cmb-td").find("input[type=checkbox]:not([disabled])");if(a.data("checked")){b.prop("checked",false);a.data("checked",false)}else{b.prop("checked",true);a.data("checked",true)}};l.handleMedia=function(b){b.preventDefault();var a=n(this);l.attach_id=!a.hasClass("cmb2-upload-list")?a.closest(".cmb-td").find(".cmb2-upload-file-id").val():false;l.attach_id="0"!==l.attach_id?l.attach_id:false;l._handleMedia(a.prev("input.cmb2-upload-file").attr("id"),a.hasClass("cmb2-upload-list"))};l.handleFileClick=function(d){d.preventDefault();var c=n(this);var a=c.closest(".cmb-td");var b=a.find(".cmb2-upload-button").hasClass("cmb2-upload-list");l.attach_id=b?c.find('input[type="hidden"]').data("id"):a.find(".cmb2-upload-file-id").val();if(l.attach_id){l._handleMedia(a.find("input.cmb2-upload-file").attr("id"),b,l.attach_id)}};l._handleMedia=function(e,b){if(!wp){return}var c=l.media;c.field=e;c.$field=m(c.field);c.fieldData=c.$field.data();c.previewSize=c.fieldData.previewsize;c.fieldName=c.$field.attr("name");var d,a;if(c.field in c.frames){c.frames[c.field].open();return}c.frames[c.field]=wp.media({title:l.metabox().find("label[for="+c.field+"]").text(),library:c.fieldData.queryargs||{},button:{text:i.strings[b?"upload_files":"upload_file"]},multiple:b?"add":false});l.mediaHandlers.list=function(f,h){a=f.toJSON();c.$field.val(a.url);m(c.field+"_id").val(a.id);var g=[];n(a).each(function(){if(this.type&&this.type==="image"){var s=c.previewSize[0]?c.previewSize[0]:50;var t=c.previewSize[1]?c.previewSize[1]:50;d='<li class="img-status"><img width="'+s+'" height="'+t+'" src="'+this.url+'" class="attachment-'+s+"px"+t+'px" alt="'+this.filename+'"><p><a href="#" class="cmb2-remove-file-button" rel="'+c.field+"["+this.id+']">'+i.strings.remove_image+'</a></p><input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+c.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}else{d='<li class="file-status"><span>'+i.strings.file+" <strong>"+this.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+i.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+c.field+"["+this.id+']">'+i.strings.remove_file+'</a>)<input type="hidden" id="filelist-'+this.id+'" data-id="'+this.id+'" name="'+c.fieldName+"["+this.id+']" value="'+this.url+'"></li>'}g.push(d)});if(!h){n(g).each(function(){c.$field.siblings(".cmb2-media-status").slideDown().append(this)})}else{return g}};l.mediaHandlers.single=function(f){a=f.first().toJSON();c.$field.val(a.url);m(c.field+"_id").val(a.id);if(a.type&&a.type==="image"){var g=c.previewSize[0]?c.previewSize[0]:350;d='<div class="img-status"><img width="'+g+'px" style="max-width: '+g+'px; width: 100%; height: auto;" src="'+a.url+'" alt="'+a.filename+'" title="'+a.filename+'" /><p><a href="#" class="cmb2-remove-file-button" rel="'+c.field+'">'+i.strings.remove_image+"</a></p></div>"}else{d='<div class="file-status"><span>'+i.strings.file+" <strong>"+a.filename+'</strong></span>&nbsp;&nbsp; (<a href="'+a.url+'" target="_blank" rel="external">'+i.strings.download+'</a> / <a href="#" class="cmb2-remove-file-button" rel="'+c.field+'">'+i.strings.remove_file+"</a>)</div>"}c.$field.siblings(".cmb2-media-status").slideDown().html(d)};l.mediaHandlers.selectFile=function(){var f=c.frames[c.field].state().get("selection");var g=b?"list":"single";if(l.attach_id&&b){n('[data-id="'+l.attach_id+'"]').parents("li").replaceWith(l.mediaHandlers.list(f,true));return}l.mediaHandlers[g](f)};l.mediaHandlers.openModal=function(){var f=c.frames[c.field].state().get("selection");if(!l.attach_id){return f.reset()}var g=wp.media.attachment(l.attach_id);g.fetch();f.set(g?[g]:[])};c.frames[c.field].on("select",l.mediaHandlers.selectFile).on("open",l.mediaHandlers.openModal);c.frames[c.field].open()};l.handleRemoveMedia=function(b){b.preventDefault();var a=n(this);if(a.is(".cmb-attach-list .cmb2-remove-file-button")){a.parents("li").remove();return false}l.media.field=a.attr("rel");l.metabox().find("input#"+l.media.field).val("");l.metabox().find("input#"+l.media.field+"_id").val("");a.parents(".cmb2-media-status").html("");return false};l.cleanRow=function(e,c,a){var d=e.find(l.repeatUpdate);if(a){var b=e.find("[id]").not(l.repeatUpdate);e.find(".cmb-repeat-table .cmb-repeat-row:not(:first-child)").remove();if(b.length){b.each(function(){var g=n(this);var f=g.attr("id");var r=f.replace("_"+c,"_"+l.idNumber);var h=e.find('[data-selector="'+f+'"]');g.attr("id",r);if(h.length){h.attr("data-selector",r).data("selector",r)}})}}l.neweditor_id=[];d.filter(":checked").prop("checked",false);d.filter(":selected").prop("selected",false);if(e.find("h3.cmb-group-title").length){e.find("h3.cmb-group-title").text(e.data("title").replace("{#}",(l.idNumber+1)))}d.each(function(){var E=n(this);var h=E.hasClass("wp-editor-area");var g=E.attr("for");var D=E.attr("value");var F=E.prop("type");var A="radio"===F||"checkbox"===F?D:false;var C={};var H,I;if(g){C={"for":g.replace("_"+c,"_"+l.idNumber)}}else{var B=E.attr("name");var G=B?B.replace("["+c+"]","["+l.idNumber+"]"):"";I=E.attr("id");H=I?I.replace("_"+c,"_"+l.idNumber):"";C={id:H,name:G,"data-iterator":l.idNumber}}if(k!==typeof(D)&&D||A){C.value=A?A:""}if("TEXTAREA"===E.prop("tagName")){E.html("")}if(A){E.removeAttr("checked")}E.removeClass("hasDatepicker").attr(C).val(A?A:"");if(h){H=H?I.replace("zx"+c,"zx"+l.idNumber):"";E.html("");var f=E.parents(".cmb-type-wysiwyg");f.find(".mce-tinymce:not(:first-child)").remove();var J=f.html().replace(new RegExp(I,"g"),H);f.html(J);l.neweditor_id.push({id:H,old:I})}});return l};l.newRowHousekeeping=function(c){var a=c.find(".wp-picker-container");var b=c.find(".cmb2-media-status");if(a.length){a.each(function(){var d=n(this).parent();d.html(d.find('input[type="text"].cmb2-colorpicker').attr("style",""))})}if(b.length){b.empty()}return l};l.afterRowInsert=function(b){var f;if(l.neweditor_id.length){var g;for(g=l.neweditor_id.length-1;g>=0;g--){var e=l.neweditor_id[g].id;var a=l.neweditor_id[g].old;if(typeof(tinyMCEPreInit.mceInit[e])==="undefined"){var c=jQuery.extend({},tinyMCEPreInit.mceInit[a]);for(f in c){if("string"===typeof(c[f])){c[f]=c[f].replace(new RegExp(a,"g"),e)}}tinyMCEPreInit.mceInit[e]=c}if(typeof(tinyMCEPreInit.qtInit[e])==="undefined"){var d=jQuery.extend({},tinyMCEPreInit.qtInit[a]);for(f in d){if("string"===typeof(d[f])){d[f]=d[f].replace(new RegExp(a,"g"),e)}}tinyMCEPreInit.qtInit[e]=d}tinyMCE.init({id:tinyMCEPreInit.mceInit[e]})}}l.initPickers(b.find('input[type="text"].cmb2-timepicker'),b.find('input[type="text"].cmb2-datepicker'),b.find('input[type="text"].cmb2-colorpicker'))};l.updateNameAttr=function(){var a=n(this);var d=a.attr("name");if(typeof d!=="undefined"){var c=parseInt(a.parents(".cmb-repeatable-grouping").data("iterator"));var b=c-1;var e=d.replace("["+c+"]","["+b+"]");a.attr("name",e)}};l.emptyValue=function(b,a){n(l.noEmpty,a).val("")};l.addGroupRow=function(d){d.preventDefault();var f=n(this);f.trigger("cmb2_add_group_row_start",f);var c=m(f.data("selector"));var a=c.find(".cmb-repeatable-grouping").last();var b=parseInt(a.data("iterator"));l.idNumber=b+1;var e=a.clone();l.newRowHousekeeping(e.data("title",f.data("grouptitle"))).cleanRow(e,b,true);e.find(".cmb-add-row-button").prop("disabled",false);var g=n('<div class="postbox cmb-row cmb-repeatable-grouping" data-iterator="'+l.idNumber+'">'+e.html()+"</div>");a.after(g);l.afterRowInsert(g);if(c.find(".cmb-repeatable-grouping").length<=1){c.find(".cmb-remove-group-row").prop("disabled",true)}else{c.find(".cmb-remove-group-row").prop("disabled",false)}c.trigger("cmb2_add_row",g)};l.addAjaxRow=function(d){d.preventDefault();var f=n(this);var c=m(f.data("selector"));var a=c.find(".empty-row");var b=parseInt(a.find("[data-iterator]").data("iterator"));l.idNumber=b+1;var e=a.clone();l.newRowHousekeeping(e).cleanRow(e,b);a.removeClass("empty-row hidden").addClass("cmb-repeat-row");a.after(e);l.afterRowInsert(e);c.trigger("cmb2_add_row",e);c.find(".cmb-remove-row-button").removeClass("button-disabled")};l.removeGroupRow=function(e){e.preventDefault();var a=n(this);var d=m(a.data("selector"));var b=a.parents(".cmb-repeatable-grouping");var c=d.find(".cmb-repeatable-grouping").length;if(c>1){d.trigger("cmb2_remove_group_row_start",a);b.nextAll(".cmb-repeatable-grouping").find(l.repeatEls).each(l.updateNameAttr);b.remove();if(c<=2){d.find(".cmb-remove-group-row").prop("disabled",true)}else{d.find(".cmb-remove-group-row").prop("disabled",false)}d.trigger("cmb2_remove_row")}};l.removeAjaxRow=function(e){e.preventDefault();var a=n(this);if(a.hasClass("button-disabled")){return}var b=a.parents(".cmb-row");var d=a.parents(".cmb-repeat-table");var c=d.find(".cmb-row").length;if(c>2){if(b.hasClass("empty-row")){b.prev().addClass("empty-row").removeClass("cmb-repeat-row")}a.parents(".cmb-repeat-table .cmb-row").remove();if(c===3){d.find(".cmb-remove-row-button").addClass("button-disabled")}d.trigger("cmb2_remove_row")}else{a.addClass("button-disabled")}};l.shiftRows=function(d){d.preventDefault();var a=n(this);a.trigger("cmb2_shift_rows_enter",a);var b=a.parents(".cmb-repeatable-grouping");var e=a.hasClass("move-up")?b.prev(".cmb-repeatable-grouping"):b.next(".cmb-repeatable-grouping");if(!e.length){return}a.trigger("cmb2_shift_rows_start",a);var c=[];b.find(l.repeatEls).each(function(){var g=n(this);var h=g.attr("type");var f;if(g.hasClass("cmb2-media-status")){f=g.html()}else{if("checkbox"===h||"radio"===h){f=g.is(":checked")}else{if("select"===g.prop("tagName")){f=g.is(":selected")}else{f=g.val()}}}c.push({val:f,$:g})});e.find(l.repeatEls).each(function(h){var u=n(this);var v=u.attr("type");var g;if(u.hasClass("cmb2-media-status")){var t=u.closest(".cmb-repeatable-grouping").attr("data-iterator");var f=c[h]["$"].closest(".cmb-repeatable-grouping").attr("data-iterator");g=u.html();u.html(c[h].val);c[h].$.html(g);c[h].$.find("input").each(function(){var q=n(this).attr("name");q=q.replace("["+t+"]","["+f+"]");n(this).attr("name",q)});u.find("input").each(function(){var q=n(this).attr("name");q=q.replace("["+f+"]","["+t+"]");n(this).attr("name",q)})}else{if("checkbox"===v){c[h].$.prop("checked",u.is(":checked"));u.prop("checked",c[h].val)}else{if("radio"===v){if(u.is(":checked")){c[h].$.attr("data-checked","true")}if(c[h].$.is(":checked")){u.attr("data-checked","true")}}else{if("select"===u.prop("tagName")){c[h].$.prop("selected",u.is(":selected"));u.prop("selected",c[h].val)}else{c[h].$.val(u.val());u.val(c[h].val)}}}}});b.find("input[data-checked=true]").prop("checked",true).removeAttr("data-checked");e.find("input[data-checked=true]").prop("checked",true).removeAttr("data-checked");a.trigger("cmb2_shift_rows_complete",a)};l.initPickers=function(b,a,c){l.initTimePickers(b);l.initDatePickers(a);l.initColorPickers(c)};l.initTimePickers=function(a){if(!a.length){return}a.timepicker("destroy");a.timepicker(l.defaults.time_picker)};l.initDatePickers=function(a){if(!a.length){return}a.datepicker("destroy");a.datepicker(l.defaults.date_picker)};l.initColorPickers=function(a){if(!a.length){return}if(typeof jQuery.wp==="object"&&typeof jQuery.wp.wpColorPicker==="function"){a.wpColorPicker(l.defaults.color_picker)}else{a.each(function(b){n(this).after('<div id="picker-'+b+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>');m("picker-"+b).hide().farbtastic(n(this))}).focus(function(){n(this).next().show()}).blur(function(){n(this).next().hide()})}};l.makeListSortable=function(){var a=l.metabox().find(".cmb2-media-status.cmb-attach-list");if(a.length){a.sortable({cursor:"move"}).disableSelection()}};l.maybeOembed=function(c){var a=n(this);var b=c.type;var d={focusout:function(){o(function(){l.spinner(".postbox .cmb2-metabox",true)},2000)},keyup:function(){var e=function(f,g){return(c.which<=g&&c.which>=f)};if(e(48,90)||e(96,111)||e(8,9)||c.which===187||c.which===190){l.doAjax(a,c)}},paste:function(){o(function(){l.doAjax(a)},100)}};d[b]()};l.resizeoEmbeds=function(){l.metabox().each(function(){var a=n(this);var d=a.parents(".inside");var h=a.parents(".inner-sidebar").length||a.parents("#side-sortables").length;var f=h;var g=false;if(!d.length){return true}var r=d.width();if(l.styleBreakPoint>r){f=true;g=(l.styleBreakPoint-62)>r}r=f?r:Math.round((d.width()*0.82)*0.97);var e=r-30;if(f&&!h&&!g){e=e-75}if(e>639){return true}var c=a.find(".cmb-type-oembed .embed-status");var b=c.children().not(".cmb2-remove-wrapper");if(!b.length){return true}b.each(function(){var w=n(this);var y=w.width();var q=w.height();var x=e;if(w.parents(".cmb-repeat-row").length&&!f){x=e-91;x=785>r?x-15:x}var z=Math.round((x*q)/y);w.width(x).height(z)})})};l.log=function(){if(i.script_debug&&console&&typeof console.log==="function"){console.log.apply(console,arguments)}};l.spinner=function(b,a){if(a){n(".cmb-spinner",b).hide()}else{n(".cmb-spinner",b).show()}};l.doAjax=function(f){var b=f.val();if(b.length<6){return}var a=f.attr("id");var e=f.closest(".cmb-td");var g=e.find(".embed-status");var h=e.find(".embed_wrap");var d=g.find(":first-child");var c=g.length&&d.length?d.width():f.width();l.log("oembed_url",b,a);l.spinner(e);h.html("");o(function(){if(n(".cmb2-oembed:focus").val()!==b){return}n.ajax({type:"post",dataType:"json",url:i.ajaxurl,data:{action:"cmb2_oembed_handler",oembed_url:b,oembed_width:c>300?c:300,field_id:a,object_id:f.data("objectid"),object_type:f.data("objecttype"),cmb2_ajax_nonce:i.ajax_nonce},success:function(r){l.log(r);l.spinner(e,true);h.html(r.data)}})},500)};n(j).ready(l.init);return l})(window,document,jQuery);